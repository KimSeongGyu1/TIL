# 운영체제와 정보기술의 원리(반효경)

### 4장(프로그램의 구조와 실행)

<details>
  <summary> 프로그램의 구조와 인터럽트 </summary>
  </br>
  <p>프로그램이 CPU에서 수행되려면 해당 명령을 담은 프로그램의 주소 영역이 메모리에 올라가 있어야 한다</p>
  <p>이때 프로그램의 주소 영역은 코드, 데이터, 스택 영역으로 구분된다</p>
  <p>인터럽트는 함수가 스택에 쌓여가며 호출되는 것과 비슷하게 동작한다</p>
  <p>인터럽트때문에 CPU를 빼앗긴 위치는 PCB에 저장된다</p>
</details>
<hr>

<details>
  <summary> 컴퓨터 시스템의 작동 개요 </summary>
  </br>
  <p>CPU는 단순히 메모리에 존재하는 명령을 읽어와 수행하는 장치이다</p>
  <p>입출력 장치에도 각각 작은 CPU와 메모리가 존재하며 이들을 각각 입출력 컨트롤러와 로컬버퍼라 한다</p>
  <details>
    <summary> Program Counter(PC) </summary>
    </br>
    <p>CPU가 수행해야 할 메모리 주소를 담고 있는 레지스터를 PC(Program Counter)라 부룬다</p>
    <p>조건문, 반복문, 함수 호출등에 의한 주소 이동이 없는이상 PC는 항상 바로 다음 명령을 가리키며 코드를 순차적으로 수행한다</p>
    <p>PC가 메모리 주소 중 운영체제가 존재하는 부분을 가리키고 있다면 운영체제의 코드를 수행중인 것이며, 이때 CPU가 커널모드에서 수행 중이라 한다</p>
    <p>PC가 사용자 프로그램이 존재하는 메모리 위치를 가리키고 있다면 사용자모드에서 CPU가 수행되고 있다고 한다</p>
  </details>
  
  <details>
    <summary> 일반명령과 특권명령 </summary>
    </br>
    <p>CPU가 수행하는 명령은 일반명령과 특권명령으로 나뉜다</p>
    <p>일반명령은 메모리에서 자료를 읽어와 CPU에서 계산하고 결과를 메모리에 쓰는 일련의 명령들이다. 모든 프로그램이 수행할 수 있다</p>
    <p>특권 명령은 보안이 필요한 명령으로 입출력 장치, 타이머 등 각종 장치에 접근하는 명려이다. 운영체제만이 수행할 수 있다</p>
    <p>일반 프로그램에서 특권명령의 수행이 필요할 때 운영체제에게 대행을 요청한다. 이를 시스템 콜이라 한다</p>
  </details>
</details>
<hr>

<details>
  <summary> 프로그램의 실행 </summary>
  </br>
  <p>프로그램이 실행되고 있다는 것은 디스크에 존재하던 실행파일이 메모리에 적재되고, 프로그램이 CPU를 할당받고 명령을 수행하고 있는 상태이다</p>
  <p>일반적으로 실행파일은 일부분만 메모리에 올라가며 여러 실행파일들이 동시에 메모리에 올라간다. 나머지 부분은 스왑 영역에 둔다</p>
  <p>프로그램마다 독자적으로 코드, 데이터, 스택의 주소공간을 별도로 가지며 각각의 독자적인 주소공간을 가상메모리 또는 논리적 메모리라 부른다</p>
  <details>
    <summary> 운영체제도 프로그램이다 </summary>
    </br>
    <p>운영체제도 프로그램이며 코드, 데이터, 스택의 주소공간을 가진다</p>
    <p>커널의 데이터 영역에는 각종 자원을 관리하기 위한 자료구조가 저장된다. 현재 수행중인 프로그램도 이곳에 저장되는데 이를 프로세스라 부른다</p>
    <p>커널의 데이터 영역에는 각 프로세스의 상태, CPU 사용 정보, 메모리 사용 정보 등을 유지하기 위해 PCB를 두고 있다</p>
    <p>커널의 스택은 일반 프로그램과 달리 프로세스마다 별도의 스택을 두고 관리한다</p>
    <p>커널의 스택은 시스템 콜이나 인터럽트 등이 발생하는 경우에 사용한다. 일반적인 경우 프로그램들은 각자의 스택을 이용한다</p>
  </details>
</details>
<hr>

<details>
  <summary> 사용자 프로그램이 사용하는 함수 </summary>
  </br>
  <p>프로그램이 사용하는 함수는 크게 사용자 정의함수와 라이브러리 함수, 커널 함수로 구분할 수 있다</p>
  <p>printf()는 특권명령인 입출력을 수반하므로 커널함수를 호출하는 시스템 콜을 동반하게 된다</p>
  <p>시스템 콜은 인터럽트 라인을 세팅하는, 인터럽트와 비슷한 매커니즘을 이용한다</p>
</details>
<hr>

<details>
  <summary> 인터럽트 </summary>
  </br>
  <p>CPU는 매번 Program Counter가 가르키는 명령을 수행하며, 다음 명령을 수행하기 직전에 인터럽트 라인이 세팅되어있는지 체크한다</p>
  <p>인터럽트가 발생했다면 이를 처리하고 다시 직전의 프로세스로 돌아간다</p>
  <p>원칙적으로는 인터럽트 처리 중에 다른 인터럽트의 발생을 허용하지 않는다</p>
  <p>하지만 더 높은 중요도를 가진 인터럽트가 발생한다면, 현재 처리 중인 인터럽트는 잠시 멈추고 더 중요한 인터럽트를 실행한다</p>
</details>
<hr>

<details>
  <summary> 시스템 콜 </summary>
  </br>
  <p>모든 프로그램은 자기 자신의 독자적인 주소공간을 가지며, 프로그램이 함수호출을 하는 경우 자신의 주소 공간 내에서 호출이 이루어진다</p>
  <p>시스템 콜은 예외적으로 자신의 주소 공간 밖에 있는 커널의 주소 공간에 있는 함수를 호출하는 것이다</p>
  <p>일반적인 함수호출은 자신의 스택에 복귀 주소를 저장한 후 점프하지만, 시스템 콜은 주소공간 자체가 다른 곳으로 이동하므로 다른 방법이 필요하다</p>
  <p>프로그램 자신이 인터럽트 라인에 인터럽트를 세팅하는 명령을 통해 시스템 콜이 이루어진다</p>
</details>
<hr>

